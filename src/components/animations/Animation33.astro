---
import { Icon } from 'astro-icon/components';

/*
INFORMATIONS
set optionally:
- class as string
- duration as string 'value and s | ms'
- colors as string ("<innerColor>, <outerColor>") 
*/

interface Props {
  class?: string;
  duration?: string;
  colors?: string;
  href: string;
}
const {
  class: classList,
  duration = '.2s',
  colors = '#000, #fff',
  href = '#',
  ...attrs
} = Astro.props;

const bgDelay = 'calc(var(--duration) * 4)';
const [color, hoverColor] = colors.split(',');

const style = `--duration: ${duration};--color: ${color};--hoverColor: ${hoverColor};--bgDelay: ${bgDelay};`;
---

<a href={href} class={classList} style={style} {...attrs}
  ><slot />
  {
    Array.from({ length: 4 }).map((_, idx) => {
      const delay = `calc(var(--duration) * ${idx})`;
      return <span style={`--delay: ${delay};`} />;
    })
  }
  <Icon class="pencil" name="mdi:pencil" />
</a>

<style>
  a {
    display: inline-block;
    position: relative;
    z-index: 0;
    transition: var(--duration);
    background: #fff;
    padding: 0.5em 1em;
    color: #000;
    font-size: 1.5rem;
    text-decoration: none;
    .pencil {
      --size: 0.7em;
      position: absolute;
      top: -0.78em;
      left: -0.08em;
      background-color: transparent;
      width: var(--size);
      color: var(--color);
    }
    /* spans are the 4 borders */
    span {
      position: absolute;
      transition: var(--duration);
      background-color: var(--color);

      &:nth-of-type(1) {
        top: 0;
        left: 0;
        transform: scaleX(0);
        transform-origin: left;
        width: 100%;
        height: 0.08em;
      }
      &:nth-of-type(2) {
        top: 0;
        right: 0;
        transform: scaleY(0);
        transform-origin: top;
        width: 0.08em;
        height: 100%;
      }
      &:nth-of-type(3) {
        bottom: 0;
        left: 0;
        transform: scaleX(0);
        transform-origin: right;
        width: 100%;
        height: 0.08em;
      }
      &:nth-of-type(4) {
        top: 0;
        left: 0;
        transform: scaleY(0);
        transform-origin: bottom;
        width: 0.08em;
        height: 100%;
      }
    }

    /* final background */
    &::before {
      position: absolute;
      transform: scale(0);
      transform-origin: top left;
      z-index: -1;
      transition: var(--duration);
      inset: 0;
      background-color: var(--color);
      content: '';
    }

    &:hover {
      transition-delay: var(--bgDelay);
      color: var(--hoverColor);
      .pencil {
        animation: drawing33 calc(var(--duration) * 5) linear forwards;
      }
      span {
        transition-delay: var(--delay);
        &:nth-of-type(1),
        &:nth-of-type(3) {
          transform: scaleX(1);
        }
        &:nth-of-type(2),
        &:nth-of-type(4) {
          transform: scaleY(1);
        }
      }
      &::before {
        transform: scale(1);
        transition-delay: var(--bgDelay);
      }
    }
  }

  @keyframes drawing33 {
    0% {
      top: -0.78em;
      left: 0;
    }
    15.35% {
      top: -0.78em;
      left: 100%;
    }
    30.7% {
      top: calc(100% - 0.78em);
      left: 100%;
    }
    46.05% {
      top: calc(100% - 0.78em);
      left: 0;
    }
    61.4% {
      top: -0.78em;
      left: 0;
    }
    100% {
      top: calc(100% - 0.78em);
      left: calc(100% - 0.08em);
    }
  }
</style>
