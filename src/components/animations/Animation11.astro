---
import { getImage, Image } from 'astro:assets';
import rain from '@/images/animation11/rain.png';

/*
INFORMATIONS
set
- imagePath as string
set optionally:
- class as string
- duration as string 'value and s | ms'
*/

interface Props {
  imagePath: string;
  class?: string;
  duration?: string;
}
const { class: classList, imagePath, duration = '5s', ...attrs } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/**/*.{jpg,jpeg,png,webp,avif,svg,gif,eps,raw,bmp,tiff,ico}'
);
if (!images[imagePath]) throw new Error(`${imagePath} does not exist`);

const optBg = await getImage({
  src: images[imagePath](),
  format: 'webp',
  loading: 'lazy',
});
const optRain = await getImage({
  src: rain,
  format: 'webp',
  loading: 'lazy',
});
const style = `--bgUrl: url(${optBg.src}); --rainUrl: url(${optRain.src});--duration: ${duration}`;
---

<div class:list={['container12', classList]} style={style} {...attrs}>
  <Image
    id="invisible"
    src={images[imagePath]()}
    alt=""
    width={10}
    format="webp"
    loading="eager"
  />
  <div class="rain"></div>
</div>

<style>
  .container12 {
    position: relative;
    background: var(--bgUrl) center / cover;
    width: 15rem;
    #invisible {
      opacity: 0;
      width: 100%;
      height: 100%;
    }
    .rain {
      position: absolute;
      animation: rain12 var(--duration) linear infinite;
      inset: 0;
      background: var(--rainUrl);
      background-size: cover;
    }
  }
  /* if background-size is set, background-position does not accept values in % 
  */
  @keyframes rain12 {
    from {
      background-position: -4em bottom;
    }
    to {
      background-position: 0 top;
    }
  }
</style>
