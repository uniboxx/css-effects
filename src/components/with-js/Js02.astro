---
import { Image } from 'astro:assets';

interface Props {
  class?: string;
  duration?: string;
  heading?: string;
  images: { [key: string]: () => Promise<{ default: ImageMetadata }> };
}
const {
  class: classList,
  duration = '.25s',
  heading = 'JAVASCRIPT 02',
  images,
  ...attrs
} = Astro.props;

const imagesPath = Object.keys(images);

// prettier-ignore
const ids = ['hill1', 'hill2', 'hill3', 'hill4', 'hill5', 'leaf', 'plant', 'tree'];

const style = `--duration: ${duration};`;
const id = Math.random().toString(32).slice(2, 11);
---

<div id={id} class:list={['container02', classList]} style={style} {...attrs}>
  <slot name="header" />
  <section class="parallax">
    {
      imagesPath.map((image, idx) => {
        return (
          <Image
            id={ids[idx]}
            src={images[image]()}
            alt=""
            width={540}
            format="webp"
          />
        );
      })
    }
    <h3 id="title">{heading}</h3>
  </section>
  <slot name="content" />
  <slot />
</div>

<style>
  .container02 {
    position: relative;
    width: min(20rem, 100%);
    height: 11.5rem;
    /* overflow-x: clip; */
    overflow-y: scroll;
    .parallax {
      display: flex;
      position: relative;
      justify-content: center;
      align-items: center;
      height: 100%;
      overflow: clip;
      img {
        display: block;
        position: absolute;
        width: 100%;
        height: auto;
        pointer-events: none;
      }
      h3 {
        position: absolute;
        z-index: 1;
        pointer-events: none;
        font: inherit;
      }
    }
  }
</style>

<script define:vars={{ id }}>
  const container02 = document.getElementById(id);
  const title = container02.querySelector('#title');
  const leaf = container02.querySelector('#leaf');
  const hill1 = container02.querySelector('#hill1');
  const hill4 = container02.querySelector('#hill4');
  const hill5 = container02.querySelector('#hill5');

  container02.addEventListener('scroll', () => {
    const scroll = container02.scrollTop;
    title.style.marginTop = `${scroll * 2.5}px`;
    leaf.style.top = `${scroll * -1.5}px`;
    leaf.style.left = `${scroll * 1.5}px`;
    hill1.style.top = `${scroll}px`;
    hill4.style.left = `${scroll * -1.5}px`;
    hill5.style.left = `${scroll * 1.5}px`;
  });
</script>
