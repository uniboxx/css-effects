---
import { Image } from 'astro:assets';

interface Props {
  class?: string;
  duration?: string;
  heading?: string;
  images: { [key: string]: () => Promise<{ default: ImageMetadata }> };
}
const {
  class: className,
  duration = '.25s',
  heading = 'JAVASCRIPT 02',
  images,
  ...props
} = Astro.props;

const imageUrls = Object.keys(images);

// prettier-ignore
const ids = ['hill1', 'hill2', 'hill3', 'hill4', 'hill5', 'leaf', 'plant', 'tree'];
---

<div id="container02" class={className} {...props}>
  <slot name="header" />
  <section id="parallax">
    {
      imageUrls.map((image, idx) => {
        return (
          <Image
            id={ids[idx]}
            src={images[image]()}
            alt=""
            height={270}
            format="webp"
          />
        );
      })
    }
    <h3 id="title">{heading}</h3>
  </section>
  <slot name="content" />
  <slot />
</div>

<style define:vars={{ duration }}>
  #container02 {
    position: relative;
    height: 100%;
    overflow-x: hidden;
    overflow-y: scroll;
    #parallax {
      display: flex;
      position: relative;
      justify-content: center;
      align-items: center;
      height: 100%;
      overflow: hidden;
      img {
        position: absolute;
        width: auto;
        height: 100%;
        pointer-events: none;
      }
      h3 {
        position: absolute;
        z-index: 1;
        pointer-events: none;
        font: inherit;
      }
    }
  }
</style>

<script>
  const container = document.getElementById('container02') as HTMLDivElement;
  const title = document.getElementById('title') as HTMLHeadingElement;
  const leaf = document.getElementById('leaf') as HTMLImageElement;
  const hill1 = document.getElementById('hill1') as HTMLImageElement;
  const hill4 = document.getElementById('hill4') as HTMLImageElement;
  const hill5 = document.getElementById('hill5') as HTMLImageElement;

  container.addEventListener('scroll', () => {
    const scroll = container.scrollTop;
    title.style.marginTop = `${scroll * 2.5}px`;
    leaf.style.top = `${scroll * -1.5}px`;
    leaf.style.left = `${scroll * 1.5}px`;
    hill1.style.top = `${scroll}px`;
    hill4.style.left = `${scroll * -1.5}px`;
    hill5.style.left = `${scroll * 1.5}px`;
  });
</script>
