---
/*
INFORMATIONS
set
- varTexts as string with texts separated by commas
set optionally:
- class as string
- duration as string 'value and s | ms'
- timeToKeep as string 'value and s | ms'
- varColor as string
*/

interface Props {
  class?: string;
  duration?: string;
  timeToKeep?: string;
  varTexts?: string;
  varColor?: string;
}
const {
  class: classList,
  duration = '1s',
  timeToKeep = '4s',
  varTexts = 'TRANSITIONS, ANIMATIONS, TRANSFORMS',
  varColor = '#ff0',
  ...attrs
} = Astro.props;

const halfDuration = duration.match('ms')
  ? parseFloat(duration) / 2
  : (parseFloat(duration) * 1000) / 2;

const text1 = varTexts.split(',')[0];
const style = `--halfDuration: ${halfDuration}ms;--varColor: ${varColor};`;

const id = Math.random().toString(32).slice(2, 11);
---

<h3 id={id} class={classList} style={style} {...attrs}>
  <slot />
  <span class="visible">{text1}</span>
</h3>

<style>
  h3 {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.4em;
    background: #ea2027;
    padding: 1em;
    width: fit-content;
    max-width: 100%;
    color: #fff;
    font-size: 1.2rem;
    span:last-of-type {
      opacity: 0;
      transition: var(--halfDuration) ease-in-out;
      color: var(--varColor);
      &.visible {
        opacity: 1;
      }
    }
  }
</style>

<script define:vars={{ id, halfDuration, timeToKeep, varTexts }}>
  const h3 = document.getElementById(id);
  const varSpan = h3.querySelector('span:last-of-type');

  const texts = varTexts.split(',');

  const interval = timeToKeep.match('ms')
    ? parseFloat(timeToKeep)
    : parseFloat(timeToKeep) * 1000 + halfDuration;

  let index = 0;
  setInterval(() => {
    varSpan.classList.remove('visible');
    index = (index + 1) % texts?.length;
    setTimeout(() => {
      varSpan.textContent = texts[index];
      varSpan.classList.add('visible');
    }, halfDuration);
  }, interval);
</script>
